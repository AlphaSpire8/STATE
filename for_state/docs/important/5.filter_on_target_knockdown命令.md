```bash
================================================================================
命令名称: filter_on_target_knockdown
功能描述: 基于靶向敲除 (On-target Knockdown) 标准过滤细胞
================================================================================

基本语法:
  filter_on_target_knockdown [-h] 
                             -o OUTPUT 
                             [--perturbation-column PERTURBATION_COLUMN]
                             [--control-label CONTROL_LABEL]
                             [--residual-expression RESIDUAL_EXPRESSION]
                             [--cell-residual-expression CELL_RESIDUAL_EXPRESSION]
                             [--min-cells MIN_CELLS] 
                             [--layer LAYER] 
                             [--var-gene-name VAR_GENE_NAME] 
                             [--preprocess]
                             input

位置参数 (Positional Arguments):

  input
      [必选] 输入 AnnData 文件 (.h5ad) 的路径。

选项参数详解:

  -h, --help
      显示此帮助信息并退出。

  -o OUTPUT, --output OUTPUT
      [必选] 输出 AnnData 文件 (.h5ad) 的路径。

  --perturbation-column PERTURBATION_COLUMN
      [可选] adata.obs 中存储扰动标识（perturbation identities）的列名。
      默认值：gene

  --control-label CONTROL_LABEL
      [可选] perturbation_column 中标记对照组细胞（control cells）的类别名称。
      默认值：non-targeting

  --residual-expression RESIDUAL_EXPRESSION
      [可选] 扰动水平阈值的残留表达比例 (Residual fraction)。
      用于设定判断敲除是否成功的整体阈值。
      默认值：0.30

  --cell-residual-expression CELL_RESIDUAL_EXPRESSION
      [可选] 细胞水平阈值的残留表达比例。
      用于过滤单个细胞。
      默认值：0.50

  --min-cells MIN_CELLS
      [可选] 过滤后每个扰动组保留的最小细胞数量。
      默认值：30

  --layer LAYER
      [可选] 指定使用的矩阵层。
      如果设置此项，将使用 adata.layers 中的指定层代替 adata.X。

  --var-gene-name VAR_GENE_NAME
      [可选] adata.var 中包含基因名称的列名。
      默认值：gene_name

  --preprocess
      [开关] 执行预处理。
      如果设置此项，将应用 state 论文中的预处理步骤：标准化至 10k 读取深度 (read depth) 并在写入输出前进行对数变换 (log transform)。
```

```bash
原始数据
    ↓
识别扰动组和对照
    ↓
计算每个扰动的平均残留表达
    ↓
过滤残留表达 > 30% 的扰动组（群体水平）
    ↓
对剩余细胞，计算单个细胞残留表达
    ↓  
过滤残留表达 > 50% 的单个细胞（细胞水平）
    ↓
检查每个扰动组细胞数是否 ≥ 30
    ↓
可选：应用预处理（标准化+对数变换）
    ↓
输出过滤后的数据
```
